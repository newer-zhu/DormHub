<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhuhodor.app.mapper.BedMapper">
<!--    用户的预定信息-->
    <resultMap id="userBedInfo" type="com.zhuhodor.app.model.vo.BedInfo">
        <result column="bid" property="bId"></result>
        <result column="did" property="dId"></result>
        <result column="bed_num" property="bedNum"></result>
        <result column="status" property="status"></result>
        <result column="building_id" property="buildingId"></result>
        <result column="dorm_id" property="dormId"></result>
        <result column="capacity" property="capacity"></result>
        <result column="floor" property="floor"></result>
    </resultMap>

    <resultMap id="bedDetail" type="com.zhuhodor.app.model.pojo.Bed">
        <id column="id" property="id"/>
        <result column="bed_num" property="bedNum"></result>
        <result column="status" property="status"></result>
        <result column="dorm_id" property="dormId"></result>
        <result column="is_bunk" property="isBunk"></result>
        <result column="level" property="level"></result>
        <result column="version" property="version"></result>
        <result column="position" property="position"></result>
        <result column="user_id" property="userId"></result>
        <association property="user" javaType="com.zhuhodor.app.model.pojo.User">
            <id column="uid" property="id"/>
            <result column="username" property="username"/>
            <result column="nick_name" property="nickName"/>
            <result column="avatar" property="avatar"/>
        </association>
    </resultMap>

    <select id="getBedInfoByUserId" resultMap="userBedInfo" parameterType="Integer">
        SELECT
        b.id bid, b.bed_num, b.`status`,
        d.id did, d.building_id, d.capacity, d.dorm_id, d.floor
        FROM
        p_dorm d, p_bed b
        WHERE
        b.dorm_id = d.id AND b.user_id = #{userId}
    </select>

    <select id="getBedsByDormIdFromPc" resultMap="bedDetail">
        SELECT b.id, b.bed_num, b.`status`, b.position ,
        u.id uid, u.username, u.nick_name, u.avatar
        FROM `p_bed` b
        LEFT JOIN p_user u
        ON
        b.user_id = u.id
        WHERE b.dorm_id = #{dormId}
    </select>
</mapper>
